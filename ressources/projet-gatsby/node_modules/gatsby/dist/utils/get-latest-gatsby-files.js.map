{"version":3,"file":"get-latest-gatsby-files.js","names":["ROOT","path","join","__dirname","UNPKG_ROOT","FILE_NAMES","APIS","ADAPTERS","OUTPUT_FILES","_getFile","fileName","outputFileName","defaultReturn","fileToUse","data","axios","get","timeout","fs","writeFile","e","endsWith","readJSON","catch","importedFile","adapters","preferDefault","getLatestAPIs","browser","node","ssr","getLatestAdapters"],"sources":["../../src/utils/get-latest-gatsby-files.ts"],"sourcesContent":["import path from \"path\"\nimport * as fs from \"fs-extra\"\nimport axios from \"axios\"\nimport { IAdapterManifestEntry } from \"./adapter/types\"\nimport { preferDefault } from \"../bootstrap/prefer-default\"\n\nconst ROOT = path.join(__dirname, `..`, `..`)\nconst UNPKG_ROOT = `https://unpkg.com/gatsby/`\n\nconst FILE_NAMES = {\n  APIS: `apis.json`,\n  ADAPTERS: `adapters.js`,\n}\n\nconst OUTPUT_FILES = {\n  APIS: path.join(ROOT, `latest-apis.json`),\n  ADAPTERS: path.join(ROOT, `latest-adapters.js`),\n}\n\nexport interface IAPIResponse {\n  browser: Record<string, any>\n  node: Record<string, any>\n  ssr: Record<string, any>\n}\n\nconst _getFile = async <T>({\n  fileName,\n  outputFileName,\n  defaultReturn,\n}: {\n  fileName: string\n  outputFileName: string\n  defaultReturn: T\n}): Promise<T> => {\n  let fileToUse = path.join(ROOT, fileName)\n  try {\n    const { data } = await axios.get(`${UNPKG_ROOT}${fileName}`, {\n      timeout: 5000,\n    })\n\n    await fs.writeFile(outputFileName, data, `utf8`)\n\n    fileToUse = outputFileName\n  } catch (e) {\n    // no-op\n  }\n\n  if (fileToUse.endsWith(`.json`)) {\n    return fs.readJSON(fileToUse).catch(() => defaultReturn)\n  } else {\n    try {\n      const importedFile = await import(fileToUse)\n      const adapters = preferDefault(importedFile)\n      return adapters\n    } catch (e) {\n      // no-op\n      return defaultReturn\n    }\n  }\n}\n\nexport const getLatestAPIs = async (): Promise<IAPIResponse> =>\n  _getFile({\n    fileName: FILE_NAMES.APIS,\n    outputFileName: OUTPUT_FILES.APIS,\n    defaultReturn: {\n      browser: {},\n      node: {},\n      ssr: {},\n    },\n  })\n\nexport const getLatestAdapters = async (): Promise<\n  Array<IAdapterManifestEntry>\n> =>\n  _getFile({\n    fileName: FILE_NAMES.ADAPTERS,\n    outputFileName: OUTPUT_FILES.ADAPTERS,\n    defaultReturn: [],\n  })\n"],"mappings":";;;;;AAAA;AACA;AACA;AAEA;AAA2D;AAAA;AAE3D,MAAMA,IAAI,GAAGC,aAAI,CAACC,IAAI,CAACC,SAAS,EAAG,IAAG,EAAG,IAAG,CAAC;AAC7C,MAAMC,UAAU,GAAI,2BAA0B;AAE9C,MAAMC,UAAU,GAAG;EACjBC,IAAI,EAAG,WAAU;EACjBC,QAAQ,EAAG;AACb,CAAC;AAED,MAAMC,YAAY,GAAG;EACnBF,IAAI,EAAEL,aAAI,CAACC,IAAI,CAACF,IAAI,EAAG,kBAAiB,CAAC;EACzCO,QAAQ,EAAEN,aAAI,CAACC,IAAI,CAACF,IAAI,EAAG,oBAAmB;AAChD,CAAC;AAQD,MAAMS,QAAQ,GAAG,OAAU;EACzBC,QAAQ;EACRC,cAAc;EACdC;AAKF,CAAC,KAAiB;EAChB,IAAIC,SAAS,GAAGZ,aAAI,CAACC,IAAI,CAACF,IAAI,EAAEU,QAAQ,CAAC;EACzC,IAAI;IACF,MAAM;MAAEI;IAAK,CAAC,GAAG,MAAMC,cAAK,CAACC,GAAG,CAAE,GAAEZ,UAAW,GAAEM,QAAS,EAAC,EAAE;MAC3DO,OAAO,EAAE;IACX,CAAC,CAAC;IAEF,MAAMC,EAAE,CAACC,SAAS,CAACR,cAAc,EAAEG,IAAI,EAAG,MAAK,CAAC;IAEhDD,SAAS,GAAGF,cAAc;EAC5B,CAAC,CAAC,OAAOS,CAAC,EAAE;IACV;EAAA;EAGF,IAAIP,SAAS,CAACQ,QAAQ,CAAE,OAAM,CAAC,EAAE;IAC/B,OAAOH,EAAE,CAACI,QAAQ,CAACT,SAAS,CAAC,CAACU,KAAK,CAAC,MAAMX,aAAa,CAAC;EAC1D,CAAC,MAAM;IACL,IAAI;MACF,MAAMY,YAAY,GAAG,yBAAaX,SAAS,kDAAC;MAC5C,MAAMY,QAAQ,GAAG,IAAAC,4BAAa,EAACF,YAAY,CAAC;MAC5C,OAAOC,QAAQ;IACjB,CAAC,CAAC,OAAOL,CAAC,EAAE;MACV;MACA,OAAOR,aAAa;IACtB;EACF;AACF,CAAC;AAEM,MAAMe,aAAa,GAAG,YAC3BlB,QAAQ,CAAC;EACPC,QAAQ,EAAEL,UAAU,CAACC,IAAI;EACzBK,cAAc,EAAEH,YAAY,CAACF,IAAI;EACjCM,aAAa,EAAE;IACbgB,OAAO,EAAE,CAAC,CAAC;IACXC,IAAI,EAAE,CAAC,CAAC;IACRC,GAAG,EAAE,CAAC;EACR;AACF,CAAC,CAAC;AAAA;AAEG,MAAMC,iBAAiB,GAAG,YAG/BtB,QAAQ,CAAC;EACPC,QAAQ,EAAEL,UAAU,CAACE,QAAQ;EAC7BI,cAAc,EAAEH,YAAY,CAACD,QAAQ;EACrCK,aAAa,EAAE;AACjB,CAAC,CAAC;AAAA"}